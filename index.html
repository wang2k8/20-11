<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Khoảnh khắc bên thầy cô - 12A1</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #ffffff;
  }
  .container {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: #ffffff;
  }
  img {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 100%;
    max-height: 100%;
    pointer-events: none;
  }
  #enableMotion {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #000;
    color: #fff;
    font-size: 18px;
    padding: 12px 20px;
    border-radius: 12px;
    cursor: pointer;
    z-index: 999;
  }
</style>
</head>
<body>
<div class="container">
  <img id="img5" src="img1.png" alt="Image 1">
  <img id="img4" src="img2.png" alt="Image 2">
  <img id="img3" src="img3.png" alt="Image 3">
  <img id="img2" src="img4.png" alt="Image 4">
  <img id="img1" src="img5.png" alt="Image 5">
  <div id="enableMotion">Bật cảm biến</div>
</div>

<script>
const imgs = [
  { el: document.getElementById('img1'), factor: 0.1 },
  { el: document.getElementById('img2'), factor: 0.3 },
  { el: document.getElementById('img3'), factor: 0.6 },
  { el: document.getElementById('img4'), factor: 0.8 },
  { el: document.getElementById('img5'), factor: 1.0 }
];

const maxMove = 100;
const defaultGamma = 15;
const defaultBeta  = -10;

let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

// Áp dụng góc mặc định ban đầu
updateParallax(defaultGamma, defaultBeta);

function enableMotion() {
  const btn = document.getElementById('enableMotion');
  btn.style.display = 'none';

  if (typeof DeviceOrientationEvent !== 'undefined' &&
      typeof DeviceOrientationEvent.requestPermission === 'function') {
    // iOS 13+
    DeviceOrientationEvent.requestPermission()
      .then(response => {
        if (response === 'granted') {
          window.addEventListener('deviceorientation', handleOrientation);
        } else {
          alert('Bạn cần cho phép quyền cảm biến để xem hiệu ứng.');
        }
      })
      .catch(console.error);
  } else {
    // Android hoặc trình duyệt khác
    window.addEventListener('deviceorientation', handleOrientation);
  }
}

function handleOrientation(event) {
  const gamma = event.gamma || 0;
  const beta = event.beta || 0;
  updateParallax(gamma, beta);
}

function updateParallax(deltaX, deltaY) {
  imgs.forEach(img => {
    const easedX = Math.tanh(deltaX * img.factor / maxMove) * maxMove;
    const easedY = Math.tanh(deltaY * img.factor / maxMove) * maxMove;
    let rotate = 0;
    if (isMobile) rotate = deltaX * 0.05;
    img.el.style.transform = 
      `translate(-50%, -50%) translate(${easedX}px, ${easedY}px) rotate(${rotate}deg)`;
  });
}

// Gán nút
document.getElementById('enableMotion').addEventListener('click', enableMotion);
</script>
</body>
</html>
