<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>3D Viewer - Ảnh TO 250%</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body, html { height:100%; overflow:hidden; background:#000; font-family:sans-serif; }
    #container { perspective:1200px; width:100vw; height:100vh; transform-style:preserve-3d; transition:transform .1s ease-out; }
    
    /* [ẢNH TO HƠN 250%] */
    .layer {
      position:absolute; top:50%; left:50%;
      transform: translate(-50%,-50%) translateZ(0) scale(1);
      width: 225vw;           /* 90vw × 2.5 = 225vw */
      max-width: 1050px;      /* 420px × 2.5 = 1050px */
      border-radius: 24px;    /* Bo góc lớn hơn cho phù hợp */
      box-shadow: 0 0 60px rgba(0,0,0,0.9);
      opacity:0; transition:opacity .6s;
    }
    .layer img {
      width:100%; height:auto; display:block;
      border-radius: 24px;
      image-rendering: -webkit-optimize-contrast; /* Giữ nét khi phóng to */
    }
    .layer.visible { opacity:1; }

    /* THÔNG BÁO XOAY NGANG */
    #warning {
      position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.95); color:#fff;
      display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:20px; z-index:9999;
    }
    #warning svg { width:60px; height:60px; margin-bottom:15px; animation:spin 1.5s infinite linear; }
    @keyframes spin { to { transform:rotate(90deg); } }

    .landscape #warning { display:none; }
    .portrait #container { display:none; }

    #mouse-hint { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.6); color:#fff; padding:8px 16px; border-radius:20px; font-size:14px; opacity:0; transition:.3s; pointer-events:none; }
    #mouse-hint.show { opacity:1; }
  </style>
</head>
<body class="portrait">

  <div id="warning">
    <svg viewBox="0 0 24 24" fill="white"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
    <h2>Xoay điện thoại ngang</h2>
    <p><strong>Nhấn màn hình</strong> để kích hoạt 3D</p>
  </div>

  <div id="mouse-hint">Di chuột để xoay</div>
  <div id="container"></div>

  <script>
    const container = document.getElementById('container');
    const layers = [];
    const totalLayers = 5;

    // === [CÀI ĐẶT DỄ CHỈNH] ===
    const DEPTH_STEP = 100;     // Khoảng cách layer
    const SCALE_FACTOR = 0.2;   // Layer xa to hơn
    const MAX_TILT = 35;        // Góc nghiêng

    // Tạo layer
    for (let i = 1; i <= totalLayers; i++) {
      const div = document.createElement('div');
      div.className = 'layer';
      const img = new Image();
      img.src = `img${i}.png`;
      img.draggable = false;
      div.appendChild(img);
      container.appendChild(div);

      const z = (i - 3) * DEPTH_STEP;
      const scale = 1 + Math.abs(z)/1000 * SCALE_FACTOR;
      div.style.transform = `translate(-50%,-50%) translateZ(${z}px) scale(${scale})`;
      layers.push(div);
    }

    setTimeout(() => layers.forEach((l,i) => setTimeout(() => l.classList.add('visible'), i*150)), 300);

    // === XOAY MÀN HÌNH ===
    function checkOrientation() {
      document.body.className = window.innerHeight < window.innerWidth ? 'landscape' : 'portrait';
    }
    window.addEventListener('orientationchange', checkOrientation);
    window.addEventListener('resize', checkOrientation);
    checkOrientation();

    // === MOBILE: CẢM BIẾN ===
    let sensorEnabled = false;
    function enableSensor() {
      if (sensorEnabled) return;
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission().then(res => {
          if (res === 'granted') { sensorEnabled = true; startSensor(); }
        });
      } else {
        sensorEnabled = true; startSensor();
      }
    }

    function startSensor() {
      window.addEventListener('deviceorientation', e => {
        if (!sensorEnabled || window.innerHeight > window.innerWidth) return;
        const x = Math.max(-MAX_TILT, Math.min(MAX_TILT, e.gamma));
        const y = Math.max(-MAX_TILT, Math.min(MAX_TILT, e.beta - 45));
        container.style.transform = `rotateY(${x}deg) rotateX(${-y}deg)`;
      });
    }

    document.body.addEventListener('touchstart', () => {
      if (!sensorEnabled) enableSensor();
    }, { once: true });

    // === DESKTOP: CHUỘT ===
    const isDesktop = !/Mobi|Android|iPhone/i.test(navigator.userAgent);
    if (isDesktop) {
      document.addEventListener('mousemove', e => {
        const rect = container.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top + rect.height/2;
        const x = ((e.clientX - cx) / cx) * MAX_TILT;
        const y = ((e.clientY - cy) / cy) * MAX_TILT;
        container.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
      });
      document.addEventListener('mouseleave', () => container.style.transform = '');
      setTimeout(() => document.getElementById('mouse-hint').classList.add('show'), 1000);
      setTimeout(() => document.getElementById('mouse-hint').classList.remove('show'), 5000);
    }

    if (window.innerHeight < window.innerWidth && !sensorEnabled) {
      setTimeout(() => alert("Nhấn màn hình để bắt đầu 3D"), 800);
    }
  </script>
</body>
</html>
