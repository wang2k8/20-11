<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<!-- Thi·∫øt l·∫≠p viewport gi√∫p hi·ªÉn th·ªã t·ªët tr√™n thi·∫øt b·ªã di ƒë·ªông -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>3D Layer 5n</title>

<style>
  /* Reset CSS c∆° b·∫£n */
  * {margin:0; padding:0; box-sizing:border-box;}
  html,body {
    height:100%;
    overflow:hidden;
    background:#000;
    font-family:sans-serif;
    touch-action:pan-x pan-y; /* Cho ph√©p tr∆∞·ª£t tr√™n c·∫£m ·ª©ng */
  }

  /* Kh·ªëi bao ngo√†i c√≥ ph·ªëi c·∫£nh 3D */
  #wrapper {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    perspective:1200px; /* üëà ƒê·ªô s√¢u ph·ªëi c·∫£nh */
    width:100vw; height:100vh;
    will-change:transform; /* T·ªëi ∆∞u hi·ªáu su·∫•t khi transform */
  }

  /* Container gi·ªØ t·∫•t c·∫£ layer b√™n trong, cho ph√©p gi·ªØ nguy√™n ph·ªëi c·∫£nh 3D */
  #container {
    width:100%; height:100%;
    position:relative;
    transform-style:preserve-3d; /* üëà Duy tr√¨ kh√¥ng gian 3D cho c√°c con */
  }

  /* M·ªói l·ªõp ·∫£nh (layer) */
  .layer {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    backface-visibility:hidden; /* ·∫®n m·∫∑t sau khi xoay */
    transition:opacity .4s ease;
    will-change:transform,opacity;
    opacity:0; /* ·∫®n tr∆∞·ªõc khi ·∫£nh load */
  }

  .layer img {
    width:90vw; max-width:900px; display:block;
    -webkit-user-drag:none; /* NgƒÉn k√©o ·∫£nh */
  }

  /* Khi ·∫£nh load xong th√¨ hi·ªÉn th·ªã */
  .visible {opacity:1;}

  /* N√∫t b·∫Øt ƒë·∫ßu hi·ªÉn th·ªã tr√™n mobile */
  #start-btn {
    position:fixed; top:50%; left:50%;
    transform:translate(-50%,-50%);
    background:#00aaff; color:#fff;
    border:none; border-radius:50px;
    padding:16px 32px; font-size:1.2em;
    font-weight:bold; z-index:999;
    box-shadow:0 8px 20px rgba(0,0,0,.5);
    animation:pulse 2s infinite;
    display:none; /* M·∫∑c ƒë·ªãnh ·∫©n */
  }

  /* Hi·ªáu ·ª©ng nh·∫•p nh√°y nh·∫π cho n√∫t */
  @keyframes pulse {
    0%,100% {transform:translate(-50%,-50%) scale(1);}
    50% {transform:translate(-50%,-50%) scale(1.05);}
  }

  /* Hi·ªÉn th·ªã n√∫t tr√™n m√†n nh·ªè (ƒëi·ªán tho·∫°i) */
  @media(max-width:768px) {
    #start-btn {display:block;}
  }
  /* Khi nh·∫•n n√∫t th√¨ ·∫©n n√≥ */
  #start-btn.active {display:none;}

  /* G·ª£i √Ω cho ng∆∞·ªùi d√πng khi v√†o ch·∫ø ƒë·ªô c·∫£m bi·∫øn */
  #hint {
    position:fixed;
    bottom:20px; left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,.6);
    color:#fff;
    padding:8px 16px;
    border-radius:20px;
    font-size:14px;
    opacity:0;
    transition:opacity .3s;
    pointer-events:none;
    z-index:10;
  }
  #hint.show {opacity:1;}
</style>
</head>
<body>

<!-- N√∫t b·∫Øt ƒë·∫ßu (hi·ªÉn th·ªã tr√™n ƒëi·ªán tho·∫°i) -->
<button id="start-btn">B·∫ÆT ƒê·∫¶U 3D</button>
<!-- G·ª£i √Ω hi·ªán trong v√†i gi√¢y khi b·∫Øt ƒë·∫ßu -->
<div id="hint">Nghi√™ng ƒëi·ªán tho·∫°i ƒë·ªÉ xem 3D</div>

<!-- V√πng 3D -->
<div id="wrapper">
  <div id="container"></div>
</div>

<script>
/* --- L·∫•y c√°c ph·∫ßn t·ª≠ DOM --- */
const wrapper=document.getElementById('wrapper');
const container=document.getElementById('container');
const startBtn=document.getElementById('start-btn');
const hint=document.getElementById('hint');

/* --- C·∫•u h√¨nh layer --- */
const totalLayers=5; // T·ªïng s·ªë ·∫£nh
const layers=[];
/* M·ªói layer c√≥ v·ªã tr√≠ Z, t·ªâ l·ªá scale, ƒë·ªô m·ªù v√† ƒë·ªô parallax ri√™ng */
const settings=[
  {z:0,   scale:1.8, opacity:1,   parallax:0.2},
  {z:200, scale:1.5, opacity:1,   parallax:0.4},
  {z:335, scale:1.3, opacity:1,   parallax:0.6},
  {z:470, scale:1.1, opacity:0.95,parallax:0.8},
  {z:535, scale:1.0, opacity:1,   parallax:1}
];

/* --- Bi·∫øn ƒëi·ªÅu khi·ªÉn hi·ªáu ·ª©ng --- */
let is3D=false; // C√≥ ƒëang k√≠ch ho·∫°t ch·∫ø ƒë·ªô 3D kh√¥ng
let tiltX=0, tiltY=0; // G√≥c nghi√™ng
let zoom=1; // Thu ph√≥ng
let scrollY=0; // D·ªãch theo tr·ª•c Y
const MAX_TILT=1.8; // üëà Gi·ªõi h·∫°n g√≥c nghi√™ng t·ªëi ƒëa

/* --- H√†m render c·∫≠p nh·∫≠t g√≥c, zoom v√† v·ªã tr√≠ t·ª´ng layer --- */
function render(){
  if(!is3D) return;
  /* Xoay t·ªïng th·ªÉ theo tiltX/Y v√† scale */
  container.style.transform=`rotateX(${tiltX}deg) rotateY(${tiltY}deg) scale(${zoom})`;

  /* M·ªói layer c√≥ parallax v√† z kh√°c nhau */
  layers.forEach((l,i)=>{
    const s=settings[i];
    const offset=scrollY*s.parallax;
    l.style.transform=`
      translate(-50%,-50%)
      translateZ(${s.z}px)
      translateY(${offset}px)
      scale(${s.scale})
    `;
  });
}

/* --- T·∫°o c√°c layer v√† load ·∫£nh --- */
function setupLayers(){
  for(let i=0;i<totalLayers;i++){
    const div=document.createElement('div');
    div.className='layer';
    const img=new Image();
    img.src=`img${i+1}.png`; // ‚ö†Ô∏è ·∫¢nh ph·∫£i ƒë·∫∑t t√™n img1.png ‚Üí img5.png
    img.onload=()=>div.classList.add('visible'); // Hi·ªán khi load xong
    div.appendChild(img);
    container.appendChild(div);
    layers.push(div);
  }
  render();
}

setupLayers();

/* --- To√†n m√†n h√¨nh --- */
function goFullscreen(){
  const el=document.documentElement;
  if(el.requestFullscreen) el.requestFullscreen();
  else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();
}

/* --- Ki·ªÉm tra thi·∫øt b·ªã --- */
const isMobile=/Mobi|Android|iPhone/i.test(navigator.userAgent);

/* --- ƒêi·ªÅu khi·ªÉn b·∫±ng chu·ªôt (desktop) --- */
if(!isMobile){
  is3D=true;
  goFullscreen();
  document.addEventListener('mousemove',e=>{
    const rect=wrapper.getBoundingClientRect();
    const cx=rect.left+rect.width/2;
    const cy=rect.top+rect.height/2;
    /* X√°c ƒë·ªãnh ƒë·ªô l·ªách con tr·ªè so v·ªõi t√¢m */
    tiltY=((e.clientX-cx)/cx)*MAX_TILT;
    tiltX=-((e.clientY-cy)/cy)*MAX_TILT;
    render();
  });
}
/* --- ƒêi·ªÅu khi·ªÉn b·∫±ng c·∫£m bi·∫øn (mobile) --- */
else {
  startBtn.addEventListener('click',()=>{
    startBtn.classList.add('active');
    goFullscreen();
    startSensor();
    hint.classList.add('show');
    setTimeout(()=>hint.classList.remove('show'),3000);
  });
}

/* --- L√†m m∆∞·ª£t c·∫£m bi·∫øn --- */
let smoothX=0, smoothY=0;
const SMOOTH=0.12;

function startSensor(){
  is3D=true;
  /* V·ªõi iOS c·∫ßn xin quy·ªÅn truy c·∫≠p c·∫£m bi·∫øn */
  if(typeof DeviceOrientationEvent.requestPermission==='function'){
    DeviceOrientationEvent.requestPermission()
      .then(state=>{
        if(state==='granted')
          window.addEventListener('deviceorientation',handleOri);
        else fallbackTouch();
      })
      .catch(fallbackTouch);
  } else {
    window.addEventListener('deviceorientation',handleOri);
  }
}

/* --- X·ª≠ l√Ω d·ªØ li·ªáu c·∫£m bi·∫øn nghi√™ng --- */
function handleOri(e){
  if(!is3D)return;
  let gx=e.gamma||0; // Nghi√™ng tr√°i/ph·∫£i
  let gy=e.beta||0;  // Nghi√™ng tr∆∞·ªõc/sau
  /* L√†m m∆∞·ª£t chuy·ªÉn ƒë·ªông */
  smoothX+=(gx-smoothX)*SMOOTH;
  smoothY+=(gy-smoothY)*SMOOTH;
  /* Gi·ªõi h·∫°n g√≥c xoay */
  tiltY=Math.max(-MAX_TILT,Math.min(MAX_TILT,smoothX));
  tiltX=Math.max(-MAX_TILT,Math.min(MAX_TILT, smoothY-45));
  render();
}

/* --- Tr∆∞·ªùng h·ª£p c·∫£m bi·∫øn kh√¥ng h·ªó tr·ª£: fallback b·∫±ng c·∫£m ·ª©ng --- */
function fallbackTouch(){
  let sx=0, sy=0;
  container.addEventListener('touchstart',e=>{
    if(e.touches.length===1){
      sx=e.touches[0].clientX;
      sy=e.touches[0].clientY;
    }
  },{passive:true});

  container.addEventListener('touchmove',e=>{
    if(e.touches.length!==1)return;
    const dx=(e.touches[0].clientX-sx)/innerWidth;
    const dy=(e.touches[0].clientY-sy)/innerHeight;
    tiltY=dx*MAX_TILT*2;
    tiltX=-dy*MAX_TILT*2;
    render();
  },{passive:true});
}

/* --- Cu·ªôn chu·ªôt ƒë·ªÉ di chuy·ªÉn chi·ªÅu s√¢u ho·∫∑c thay ƒë·ªïi zoom --- */
document.addEventListener('wheel',e=>{
  if(!is3D)return;
  scrollY=Math.max(-30,Math.min(30,scrollY+e.deltaY*0.05));
  render();
},{passive:true});

/* --- Zoom b·∫±ng hai ng√≥n (pinch) --- */
let pinch=0;
container.addEventListener('touchmove',e=>{
  if(e.touches.length===2){
    const d=Math.hypot(
      e.touches[0].pageX-e.touches[1].pageX,
      e.touches[0].pageY-e.touches[1].pageY);
    if(!pinch)pinch=d;
    zoom=Math.max(0.6,Math.min(2.5,zoom*(d/pinch)));
    pinch=d;
    render();
  }
},{passive:true});
container.addEventListener('touchend',()=>pinch=0);

/* --- X·ª≠ l√Ω khi xoay d·ªçc/ngang m√†n h√¨nh ƒëi·ªán tho·∫°i --- */
function adjustRotate(){
  if(!isMobile)return;
  const land=innerWidth>innerHeight;
  wrapper.style.transform=`translate(-50%,-50%) rotate(${land?0:90}deg)`;
}
window.addEventListener('orientationchange',()=>setTimeout(adjustRotate,400));
adjustRotate();

</script>
</body>
</html>
